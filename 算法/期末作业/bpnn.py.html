<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF0000;
}
.sc4 {
	color: #808080;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
}
.sc9 {
	color: #FF00FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc5">import</span><span class="sc0"> </span><span class="sc11">math</span><span class="sc0">
</span><span class="sc5">import</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc0">

</span><span class="sc11">random</span><span class="sc10">.</span><span class="sc11">seed</span><span class="sc10">(</span><span class="sc2">0</span><span class="sc10">)</span><span class="sc0">

</span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">rand</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">):</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc10">.</span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0">

</span><span class="sc1"># 创造一个指定大小的矩阵</span><span class="sc0">
</span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">make_matrix</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fill</span><span class="sc10">=</span><span class="sc2">0.0</span><span class="sc10">):</span><span class="sc0">
    </span><span class="sc11">mat</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">):</span><span class="sc0">
        </span><span class="sc11">mat</span><span class="sc10">.</span><span class="sc11">append</span><span class="sc10">([</span><span class="sc11">fill</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">mat</span><span class="sc0">

</span><span class="sc1">#定义sigmoid函数和它的导数</span><span class="sc0">
</span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">sigmoid</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">):</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc2">1.0</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">math</span><span class="sc10">.</span><span class="sc11">exp</span><span class="sc10">(-</span><span class="sc11">x</span><span class="sc10">))</span><span class="sc0">

</span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">sigmoid_derivative</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">):</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">

</span><span class="sc5">class</span><span class="sc0"> </span><span class="sc8">BPNeuralNetwork</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">__init__</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">):</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_cells</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_cells</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_cells</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_weights</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_weights</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_correction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_correction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0">

    </span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">setup</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ni</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">no</span><span class="sc10">):</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ni</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">    </span><span class="sc1">#输入层+偏置项</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nh</span><span class="sc0">       </span><span class="sc1">#隐含层</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">no</span><span class="sc0">       </span><span class="sc1">#输出层</span><span class="sc0">
        </span><span class="sc1"># 初始化神经元</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_cells</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">1.0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_cells</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">1.0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_cells</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">1.0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc0">
        </span><span class="sc1"># 初始化权值</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_weights</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">make_matrix</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc1">#邻接矩阵存边权：输入层-&gt;隐藏层</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_weights</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">make_matrix</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc10">)</span><span class="sc1">#邻接矩阵存边权：隐藏层-&gt;输出层</span><span class="sc0">
        </span><span class="sc1"># 随机激活</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">):</span><span class="sc0">
                </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_weights</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">][</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">(-</span><span class="sc2">0.2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">0.2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">o</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc10">):</span><span class="sc0">
                </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_weights</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">][</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">(-</span><span class="sc2">0.2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">0.2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc1"># 初始化校正矩阵</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_correction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">make_matrix</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_correction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">make_matrix</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc10">)</span><span class="sc0">

    </span><span class="sc1">#输出预测值 </span><span class="sc0">
    </span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">predict</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">inputs</span><span class="sc10">):</span><span class="sc0">
        </span><span class="sc1"># 激活输入层</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_cells</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inputs</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc1"># 激活隐含层</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc11">total</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc10">):</span><span class="sc0">
                </span><span class="sc11">total</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_cells</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_weights</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">][</span><span class="sc11">j</span><span class="sc10">]</span><span class="sc0">
            </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_cells</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sigmoid</span><span class="sc10">(</span><span class="sc11">total</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc1"># 激活输出层</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc11">total</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">):</span><span class="sc0">
                </span><span class="sc11">total</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_cells</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_weights</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">][</span><span class="sc11">k</span><span class="sc10">]</span><span class="sc0">
            </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_cells</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sigmoid</span><span class="sc10">(</span><span class="sc11">total</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_cells</span><span class="sc10">[:]</span><span class="sc0">

    </span><span class="sc1">#反向传播算法：调用预测函数，根据反向传播获取权重后前向预测，将结果与实际结果返回比较误差</span><span class="sc0">
    </span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">back_propagate</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">case</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">label</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">learn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">correct</span><span class="sc10">):</span><span class="sc0"> 
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">predict</span><span class="sc10">(</span><span class="sc11">case</span><span class="sc10">)</span><span class="sc0">    </span><span class="sc1">#对输入样本做预测</span><span class="sc0">
        </span><span class="sc11">output_deltas</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">0.0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc0">    </span><span class="sc1"># 获取输出层误差</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">o</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc11">error</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">label</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_cells</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0">
            </span><span class="sc11">output_deltas</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sigmoid_derivative</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_cells</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">error</span><span class="sc1">#神经元激励函数将误差映射到[0,1]区间</span><span class="sc0">
        </span><span class="sc11">hidden_deltas</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">0.0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc0">    </span><span class="sc1"># 获取隐含层误差</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc11">error</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">o</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc10">):</span><span class="sc0">
                </span><span class="sc11">error</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">output_deltas</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_weights</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">][</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0">
            </span><span class="sc11">hidden_deltas</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sigmoid_derivative</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_cells</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">error</span><span class="sc0">
        </span><span class="sc1"># 更新输出层权重</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">o</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_n</span><span class="sc10">):</span><span class="sc0">
                </span><span class="sc11">change</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">output_deltas</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_cells</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0">
                </span><span class="sc1">#调整权重：上一层每个节点的权重学习*变化+矫正率</span><span class="sc0">
                </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_weights</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">][</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">learn</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">change</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">correct</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_correction</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">][</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0">
                </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_correction</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">][</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">change</span><span class="sc0">
        </span><span class="sc1"># 更新输入层权重</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_n</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">hidden_n</span><span class="sc10">):</span><span class="sc0">
                </span><span class="sc11">change</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hidden_deltas</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_cells</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0">
                </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_weights</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">][</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">learn</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">change</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">correct</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_correction</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">][</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0">
                </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">input_correction</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">][</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">change</span><span class="sc0">
        </span><span class="sc1"># 获取全局误差</span><span class="sc0">
        </span><span class="sc11">error</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">o</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">(</span><span class="sc11">label</span><span class="sc10">)):</span><span class="sc0">
            </span><span class="sc11">error</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc2">0.5</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">label</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">output_cells</span><span class="sc10">[</span><span class="sc11">o</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">**</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc1">#平方误差函数 </span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">error</span><span class="sc0">

    </span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">train</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cases</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">labels</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">limit</span><span class="sc10">=</span><span class="sc2">10000</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">learn</span><span class="sc10">=</span><span class="sc2">0.05</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">correct</span><span class="sc10">=</span><span class="sc2">0.1</span><span class="sc10">):</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">limit</span><span class="sc10">):</span><span class="sc0">
            </span><span class="sc11">error</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">range</span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">(</span><span class="sc11">cases</span><span class="sc10">)):</span><span class="sc0">
                </span><span class="sc11">label</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">labels</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0">
                </span><span class="sc11">case</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">cases</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0">
                </span><span class="sc11">error</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">back_propagate</span><span class="sc10">(</span><span class="sc11">case</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">label</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">learn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">correct</span><span class="sc10">)</span><span class="sc1">#样例，标签，学习率，正确阈值</span><span class="sc0">

    </span><span class="sc5">def</span><span class="sc0"> </span><span class="sc9">test</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">):</span><span class="sc0">
        </span><span class="sc11">cases</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc0">
            </span><span class="sc10">[</span><span class="sc2">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc10">],</span><span class="sc0">
            </span><span class="sc10">[</span><span class="sc2">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc10">],</span><span class="sc0">
            </span><span class="sc10">[</span><span class="sc2">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc10">],</span><span class="sc0">
            </span><span class="sc10">[</span><span class="sc2">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc10">],</span><span class="sc0">
        </span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc11">labels</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">[[</span><span class="sc2">0</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc2">0</span><span class="sc10">]]</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">setup</span><span class="sc10">(</span><span class="sc2">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">train</span><span class="sc10">(</span><span class="sc11">cases</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">labels</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">10000</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">0.05</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">0.1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">case</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">cases</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc5">print</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">predict</span><span class="sc10">(</span><span class="sc11">case</span><span class="sc10">))</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">__name__</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">'__main__'</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">nn</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BPNeuralNetwork</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc11">nn</span><span class="sc10">.</span><span class="sc11">test</span><span class="sc10">()</span><span class="sc0">
</span></div></body>
</html>
